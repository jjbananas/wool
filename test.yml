# Columns
column money:
    type: decimal(10,2)
    default: 0.00

column identity:
    type: int(10)
    increment: true
    unsigned: true
		
column primary:
    type: int(10)
    increment: true
    unsigned: true
    primary: true

column email:
    type: varchar(50)

column password:
    type: varchar(50)
    
    
cart:
    info:
        name: Shopping Cart
        shortName: Cart
        description: Shopping cart for adding products.
        
    columns:
        cartId:
            type: primary
            
        shipping:
            type: money
            name: Shipping Cost
    
    derived:
        subTotal:
            sum: cart_line.net
            name: Sub Total
            
        net:
            fetch: shipping + subTotal
            name: Net
            
        tax:
            sum: cart_line.tax
            name: Tax
				
        total:
            fetch: net + tax
            name: Total
            
            
cart_line:
    info:
        name: Cart Line
        description: A shopping cart line inserts a particular product within a cart.
        
    columns:
        cartLineId:
            type: primary
            
        quantity:
            type: int(10)
            
        cart:
            type: key
            update: cascade
            delete: cascade
			
        product:
            type: key
            update: cascade
            delete: cascade
            
    derived:
        title:
            fetch: product.title
            
        itemPrice:
            fetch: product.price
            
        net:
            fetch: itemPrice * quantity
        
        tax:
            fetch: net * product.tax.rate
            
        total:
            fetch: net + tax
            
            
product:
    columns:
        productId:
            type: primary
            
        price:
            type: money
            history: old|new|diff
            
        title:
            type: varchar(50)
            history: old|new
            
        tax:
            type: key
            update: cascade
            delete: cascade
            
    index:
        unique productId_price: [productId, price]
        
tax:
    columns:
        taxId:
            type: primary
            
        rate:
            type: float

            
invoice:
    columns:
        invoiceId:
            type: primary
    
        cart:
            type: key
            update: cascade
            delete: cascade
        
    derived:
        net:
            sum: invoice_line.net
            
        tax:
            sum: invoice_line.tax
				
        total:
            fetch: net + tax

            
invoice_line:
    columns:
        invoiceLineId:
            type: primary
            
        invoice:
            type: key
            update: cascade
            delete: cascade
            
        cart_line:
            type: key
            update: cascade
            delete: cascade
            
        quantity:
            type: int(10)
            
    derived:
        itemPrice:
            fetch: cart_line.itemPrice
            
        net:
            fetch: itemPrice * quantity
        
        tax:
            fetch: quantity * (cart_line.tax / cart_line.quantity)
            
        total:
            fetch: net + tax

            
access_roles_users:
    columns:
        accessRoleId: 
            type: primary
        
        users:
            type: key
            update: cascade
            delete: cascade


users:
    info:
        name: Users
        description: Each user has access to some part of the system, ranging from administrators to front-end customers.
        
    columns:
        userId:
            type: primary
            
        name:
            type: varchar(50)
            
        email:
            type: email
            
        password:
            type: password
            
        avatar:
            type: varchar(50)


access_locations:
    columns:
        accessLocationId:
            type: primary
            
        resource:
            type: varchar(150)
            
        access_roles:
            type: key
            update: cascade
            delete: cascade
            
        createdOn:
            type: datetime
    
        modifiedOn:
            type: datetime
    
    index:
        a: [resource]

        
access_roles:
    columns:
        accessRoleId:
            type: primary
            
        roleName:
            type: varchar(50)
            
        loginUrl:
            type: varchar(150)
            
        deniedUrl:
            type: varchar(150)


sessions:
    columns:
        sessionId:
            type: primary
            
        phpSession:
            type: varchar(32)
        
        users:
            type: key
            update: cascade
            delete: cascade
            
        ipAddress:
            type: int
            
        token:
            type: int
            
        createdOn:
            type: datetime
            
            
example:
    columns:
        name:
            type: varchar(50)
